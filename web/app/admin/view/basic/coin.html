{include file="common/head"/}
<div class="admin-main layui-anim layui-anim-upbit">
    <fieldset class="layui-elem-field layui-field-title">
        <legend>通证配置{:lang('list')}</legend>
    </fieldset>
    <blockquote class="layui-elem-quote">
        <div class="demoTable">
            <a href="{:url('coin_add')}" class="layui-btn layui-btn-small">
                {:lang('add')}通证
            </a>
            <div class="layui-inline">
                <input class="layui-input" name="key" id="key" placeholder="{:lang('pleaseEnter')}关键字">
            </div>
            <button class="layui-btn" id="search" data-type="reload">搜索</button>
            <a href="{:url('coin')}" class="layui-btn">显示全部</a>
            <!--<button type="button" class="layui-btn" id="delAll">批量删除</button>-->
        </div>
    </blockquote>

    <table class="layui-table" id="list" lay-filter="list"></table>
</div>
<script type="text/html" id="status">
    {{# if(d.status==1){ }}
    <a class="layui-btn layui-btn-xs" lay-event="status">开启</a>
    {{# }else{  }}
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="status">关闭</a>
    {{# } }}
</script>

<script type="text/html" id="is_draw">
    {{# if(d.is_draw==1){ }}
    <a class="layui-btn layui-btn-xs" lay-event="is_draw">开启</a>
    {{# }else{  }}
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="is_draw">关闭</a>
    {{# } }}
</script>

<script type="text/html" id="is_exchange">
    {{# if(d.is_exchange==1){ }}
    <a class="layui-btn layui-btn-xs" lay-event="is_exchange">开启</a>
    {{# }else{  }}
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="is_exchange">关闭</a>
    {{# } }}
</script>

<script type="text/html" id="is_recharge">
    {{# if(d.is_recharge==1){ }}
    <a class="layui-btn layui-btn-xs" lay-event="is_recharge">开启</a>
    {{# }else{  }}
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="is_recharge">关闭</a>
    {{# } }}
</script>

<script type="text/html" id="self">
    {{# if(d.self==1){ }}
    <a class="layui-btn layui-btn-xs" lay-event="self">开启</a>
    {{# }else{  }}
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="self">关闭</a>
    {{# } }}
</script>

<script type="text/html" id="default">
    {{# if(d.default==1){ }}
    <a class="layui-btn layui-btn-xs" lay-event="default">开启</a>
    {{# }else{  }}
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="default">关闭</a>
    {{# } }}
</script>

<script type="text/html" id="is_market">
    {{# if(d.is_market==1){ }}
    <a class="layui-btn layui-btn-xs" lay-event="is_market">开启</a>
    {{# }else{  }}
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="is_market">关闭</a>
    {{# } }}
</script>

<script type="text/html" id="is_lock">
    {{# if(d.is_lock==1){ }}
    <a class="layui-btn layui-btn-xs" lay-event="is_lock">开启</a>
    {{# }else{  }}
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="is_lock">关闭</a>
    {{# } }}
</script>

<script type="text/html" id="margin">
    <div class="layui-table-cell laytable-cell-1-margin">{{d.margin}}%</div>
</script>

<script type="text/html" id="action">
    <a href="{:url('coin_edit')}?id={{d.coin_id}}" class="layui-btn layui-btn-xs">编辑</a>
    <!--<a class="layui-btn layui-btn-xs" lay-event="del">删除</a>-->
</script>

<script type="text/html" id="logo">
    {{# if(d.logo!=''){ }}
    <img class="layui-btn" style="padding: 0" src="__OSS_URl__{{d.logo}}?{{d.pubdate}}">
    {{# } }}
</script>

<script type="text/html" id="logo_gif">
    {{# if(d.logo_gif!=''){ }}
    <img class="layui-btn" style="padding: 0" src="__OSS_URl__{{d.logo_gif}}?{{d.pubdate}}">
    {{# } }}
</script>


<script type="text/html" id="is_lottery">
    {{# if(d.is_lottery==1){ }}
    <a class="layui-btn layui-btn-xs" lay-event="is_lottery">开启</a>
    {{# }else{  }}
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="is_lottery">关闭</a>
    {{# } }}
</script>

{include file="common/foot"/}
<script>
    layui.use('table', function() {
        var table = layui.table, $ = layui.jquery;
        var tableIn = table.render({
            id: 'coin_id',
            elem: '#list',
            url: '{:url("coin")}',
            method: 'post',
            page: true,
            cols: [[
                {checkbox:true,fixed: true},
                {field: 'coin_id', title: '{:lang("id")}', align: 'center',width:150,fixed: true, sort: true},
                {field: 'name', title: '名称',align: 'center',width:120,sort: true},
                {field: 'short', title: '简称', align: 'center',width:150,sort: true},
                /*{field: 'mulriple', title: '发币倍数', width: 100,sort: true},*/
                {field: 'logo', title: 'logo', align: 'center',width:150,sort: true,toolbar: '#logo'},
                /*{field: 'logo_gif', title: 'logo_gif', align: 'center',width:150,sort: true,toolbar: '#logo_gif'},*/
                /*{field: 'margin', title: '涨跌幅', width: 100,sort: true,toolbar: '#margin'},
                {field: 'min_num', title: '交易最小值', width: 120,sort: true},
                {field: 'max_num', title: '交易最大值', width: 120,sort: true},
                {field: 'lottery', title: '转盘抽奖扣除数量', width: 120,sort: true},
                {field: 'trade_bonus', title: '交易总分红比例', width: 120,sort: true},
                {field: 'one_bonus', title: '交易一代分红比例', width: 120,sort: true},
                {field: 'two_bonus', title: '交易二代分红比例', width: 120,sort: true},
                {field: 'total_bonus', title: '瓜分总分红比例', width: 120,sort: true},
                {field: 'trade_fee', title: '交易手续费比例', width: 120,sort: true},*/
                {field: 'intro', title: '简介', align: 'center',width:150,sort: true},
                //{field: 'open_price', title: '开盘价', align: 'center',width:150,sort: true},
                {field: 'price', title: '当前价格', align: 'center',width:150,sort: true},
                {field: 'draw_max_day', title: '每日最大提现数量', align: 'center',width:150,sort: true},
                {field: 'draw_min_times', title: '每次最小提现数量', align: 'center',width:150,sort: true},
                {field: 'draw_min_fee', title: '提现最小手续费', align: 'center',width:150,sort: true},
                {field: 'status',title: '{:lang("status")}', align: 'center',width:150,toolbar: '#status'},
                {field: 'is_recharge',title: '是否充值', align: 'center',width:150,toolbar: '#is_recharge'},
                {field: 'is_draw',title: '是否提现', align: 'center',width:150,toolbar: '#is_draw'},
                {field: 'draw_rate', title: '提现手续费比例', align: 'center',width:150,sort: true},
                {field: 'price_cny', title: 'USDT对应RMB价格', align: 'center',width:150,sort: true},
               /* {field: 'is_exchange',title: '是否兑换', align: 'center',width:150,toolbar: '#is_exchange'},*/
                /*{field: 'is_lottery', align: 'center',width:150,title: '转盘', width: 70,toolbar: '#is_lottery'},
                {field: 'is_recharge', align: 'center',width:150,title: '充值', width: 70,toolbar: '#is_recharge'},
                {field: 'is_draw', align: 'center',width:150,title: '提现', width: 70,toolbar: '#is_draw'},
                {field: 'self', align: 'center',width:150,title: '基于公链', width: 100,toolbar: '#self'},
                {field: 'default', align: 'center',width:150,title: '默认', width: 70,toolbar: '#default'},
                {field: 'is_market', align: 'center',width:150,title: '交易', width: 70,toolbar: '#is_market'},
                {field: 'is_lock', align: 'center',width:150,title: '锁仓', width: 70,toolbar: '#is_lock'},*/
                {field: 'sort', title: '排序', align: 'center',width:150,sort: true},
                {field: 'addtime', title: '操作时间', align: 'center',width:150,sort: true},
                {title: '操作', align: 'center',width:150, toolbar: '#action'},
            ]],
            limit: 10 //每页默认显示的数量
        });
        //搜索
        $('#search').on('click', function() {
            var key = $('#key').val();
            if($.trim(key)==='') {
                layer.msg('{:lang("pleaseEnter")}关键字！',{icon:0});
                return;
            }
            tableIn.reload({
                where: {key: key}
            });
        });
        table.on('tool(list)', function(obj) {
            var data = obj.data;
            if (obj.event === 'status') {
                var loading = layer.load(1, {shade: [0.1, '#fff']});
                $.post('{:url("coin_state")}', {'coin_id': data.coin_id}, function (res) {
                    layer.close(loading);
                    if (res.status == 1) {
                        obj.update({
                            status: '<a class="layui-btn layui-btn-xs" lay-event="status">开启</a>'
                        });
                    } else {
                        obj.update({
                            status: '<a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="status">关闭</a>'
                        });
                    }
                })
            }else if (obj.event === 'is_lottery') {
                var loading = layer.load(1, {shade: [0.1, '#fff']});
                $.post('{:url("coin_is_lottery")}', {'coin_id': data.coin_id}, function (res) {
                    layer.close(loading);
                    if (res.is_lottery === 1) {
                        obj.update({
                            is_lottery: '<a class="layui-btn layui-btn-xs" lay-event="is_lottery">开启</a>'
                        });
                    } else {
                        obj.update({
                            is_lottery: '<a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="is_lottery">关闭</a>'
                        });
                    }
                })
            }else if (obj.event === 'is_recharge') {
                var loading = layer.load(1, {shade: [0.1, '#fff']});
                $.post('{:url("coin_is_recharge")}', {'coin_id': data.coin_id}, function (res) {
                    layer.close(loading);
                    if (res.is_recharge === 1) {
                        obj.update({
                            is_recharge: '<a class="layui-btn layui-btn-xs" lay-event="is_recharge">开启</a>'
                        });
                    } else {
                        obj.update({
                            is_recharge: '<a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="is_recharge">关闭</a>'
                        });
                    }
                })
            }else if (obj.event === 'is_draw') {
                var loading = layer.load(1, {shade: [0.1, '#fff']});
                $.post('{:url("coin_is_draw")}', {'coin_id': data.coin_id}, function (res) {
                    layer.close(loading);
                    if (res.is_draw === 1) {
                        obj.update({
                            is_draw: '<a class="layui-btn layui-btn-xs" lay-event="is_draw">开启</a>'
                        });
                    } else {
                        obj.update({
                            is_draw: '<a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="is_draw">关闭</a>'
                        });
                    }
                })
            }else if (obj.event === 'is_exchange') {
                var loading = layer.load(1, {shade: [0.1, '#fff']});
                $.post('{:url("coin_is_exchange")}', {'coin_id': data.coin_id}, function (res) {
                    layer.close(loading);
                    if (res.is_exchange === 1) {
                        obj.update({
                            is_exchange: '<a class="layui-btn layui-btn-xs" lay-event="is_exchange">开启</a>'
                        });
                    } else {
                        obj.update({
                            is_exchange: '<a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="is_exchange">关闭</a>'
                        });
                    }
                })
            }else if (obj.event === 'self') {
                var loading = layer.load(1, {shade: [0.1, '#fff']});
                $.post('{:url("coin_self")}', {'coin_id': data.coin_id}, function (res) {
                    layer.close(loading);
                    if (res.self === 1) {
                        obj.update({
                            self: '<a class="layui-btn layui-btn-xs" lay-event="self">开启</a>'
                        });
                    } else {
                        obj.update({
                            self: '<a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="self">关闭</a>'
                        });
                    }
                })
            }else if (obj.event === 'default') {
                var loading = layer.load(1, {shade: [0.1, '#fff']});
                $.post('{:url("coin_default")}', {'coin_id': data.coin_id}, function (res) {
                    layer.close(loading);
                    if (res.default === 1) {
                        tableIn.reload();
                    } else {
                        layer.msg('操作失败！',{time:1000,icon:2});
                    }
                })
            }else if (obj.event === 'is_market') {
                var loading = layer.load(1, {shade: [0.1, '#fff']});
                $.post('{:url("coin_is_market")}', {'coin_id': data.coin_id}, function (res) {
                    layer.close(loading);
                    if (res.is_market === 1) {
                        obj.update({
                            is_market: '<a class="layui-btn layui-btn-xs" lay-event="is_market">开启</a>'
                        });
                    } else {
                        obj.update({
                            is_market: '<a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="is_market">关闭</a>'
                        });
                    }
                })
            }else if (obj.event === 'is_lock') {
                var loading = layer.load(1, {shade: [0.1, '#fff']});
                $.post('{:url("coin_is_lock")}', {'coin_id': data.coin_id}, function (res) {
                    layer.close(loading);
                    if (res.is_lock === 1) {
                        obj.update({
                            is_lock: '<a class="layui-btn layui-btn-xs" lay-event="is_lock">开启</a>'
                        });
                    } else {
                        obj.update({
                            is_lock: '<a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="is_lock">关闭</a>'
                        });
                    }
                })
            }else if (obj.event === 'del') {
                layer.confirm('您确定要删除吗？', function(index){
                    var loading = layer.load(1, {shade: [0.1, '#fff']});
                    $.post("{:url('coin_del')}",{coin_id:data.coin_id},function(res){
                        layer.close(loading);
                        if(res.code===1){
                            layer.msg(res.msg,{time:1000,icon:1});
                            tableIn.reload();
                        }else{
                            layer.msg('操作失败！',{time:1000,icon:2});
                        }
                    });
                    layer.close(index);
                });
            }
        });

        $('#delAll').click(function(){
            layer.confirm('确认要删除选中信息吗？', {icon: 3}, function(index) {
                layer.close(index);
                var checkStatus = table.checkStatus('coin_id'); //test即为参数id设定的值
                console.log(checkStatus);
                var ids = [];
                $(checkStatus.data).each(function (i, o) {
                    ids.push(o.coin_id);
                });
                var loading = layer.load(1, {shade: [0.1, '#fff']});
                $.post("{:url('coin_delall')}", {ids: ids}, function (data) {
                    layer.close(loading);
                    if (data.code === 1) {
                        layer.msg(data.msg, {time: 1000, icon: 1});
                        tableIn.reload();
                    } else {
                        layer.msg(data.msg, {time: 1000, icon: 2});
                    }
                });
            });
        })
    });
</script>
</body>
</html>