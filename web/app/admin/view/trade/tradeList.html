{include file="common/head"/}
<div class="admin-main layui-anim layui-anim-upbit">
    <fieldset class="layui-elem-field layui-field-title">
        <legend>委托记录</legend>
    </fieldset>
    <div class="demoTable">
        <div class="layui-inline">
            <input class="layui-input" name="key" id="key" placeholder="{:lang('pleaseEnter')}关键字">
        </div>
        <div class="layui-inline">
            <label class="layui-label">交易类型：</label>
            <select class="layui-select" id="select_type">
                <option value="">全部</option>
                <option value="1">挂买</option>
                <option value="2">挂卖</option>
            </select>
        </div>
        <div class="layui-inline">
            <label class="layui-label">状态：</label>
            <select class="layui-select" id="select_status">
                <option value="">全部</option>
                <option value="-1">已撤销</option>
                <option value="0">待匹配</option>
                <option value="1">已匹配</option>
            </select>
        </div>
        <div class="layui-inline">
            <label class="layui-label">通证名称：</label>
            <select name="coin_id" id="select_status2" class="layui-select coin">
                <option value="">全部</option>
                {foreach name='cat' item='v'}
                <option value="{$v.coin_id}" name="main_coin_name">{$v.name}</option>
                {/foreach}
            </select>
        </div>
        <div class="layui-inline">
            <label class="layui-label">最终匹配等级：</label>
            <select id="select_status3" class="layui-select">
                <option value="">全部</option>
                <option value="1">1级</option>
                <option value="2">2级</option>
                <option value="3">3级</option>
                <option value="4">4级</option>
                <option value="5">5级</option>
            </select>
        </div>
        <label class="layui-label">时间：</label>
        <div class="layui-inline">
            <input type="text" class="layui-input" name="date" id="test" style="width: 300px;">
        </div>
        <button class="layui-btn" id="search" data-type="reload">搜索</button>
        <a href="{:url('trade/tradeList')}" class="layui-btn">显示全部</a>
        <br><br>

        {foreach name='buy' item='v'}
        <span style="margin-left: 100px">今日挂买{$v.name}：{$v.num} = {$v.total}USDT  人数：{$v.people}</span>
        {/foreach}
        <br>

        {foreach name='sell' item='v'}
        <span style="margin-left: 100px">今日挂卖{$v.name}：{$v.num} = {$v.total}USDT  人数：{$v.people}</span>
        {/foreach}

        <br><br><br>
        <span style="margin-left: 100px">IDO各级匹配人数</span>
        {foreach name='ido_people' item='v'}
        <span style="margin-left: 20px">{$v.final_level}级：{$v.count}人</span>
        {/foreach}

        <br>
        <span style="margin-left: 100px">ACH各级匹配人数</span>
        {foreach name='ach_people' item='v'}
        <span style="margin-left: 20px">{$v.final_level}级：{$v.count}人</span>
        {/foreach}

        <br>
        <span style="margin-left: 100px">FID各级匹配人数</span>
        {foreach name='fid_people' item='v'}
        <span style="margin-left: 20px">{$v.final_level}级：{$v.count}人</span>
        {/foreach}

        <!--<span>今日挂买IDO：{$buy_num_ido}={$buy_totle_ido}USDT</span>-->
        <!--<span style="margin-left: 50px">今日挂卖IDO：{$sell_num_ido}={$sell_totle_ido}USDT</span>-->
        <!--<span style="margin-left: 50px">今日挂买ACH：{$buy_num_ach}={$buy_totle_ach}USDT</span>-->
        <!--<span style="margin-left: 50px">今日挂卖ACH：{$sell_num_ach}={$sell_totle_ach}USDT</span>-->
    </div>
    <table class="layui-table" id="list" lay-filter="list"></table>
</div>
<script type="text/html" id="status">
    {{# if(d.status==0){ }}
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="">待匹配</a>
    {{# }else if(d.status==1){ }}
    <a class="layui-btn layui-btn-xs layui-btn" lay-event="">已匹配</a>
    {{# }else{  }}
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="">已撤销</a>
    {{# } }}
</script>

<script type="text/html" id="user_level">
    {{# if(d.user_level==1){ }}
    <a class="" lay-event="approval">新用户</a>
    {{# }else if(d.user_level==2){  }}
    <a class="" lay-event="approval">普通用户</a>
    {{# }else if(d.user_level==3){ }}
    <a class="" lay-event="approval">高级用户</a>
    {{# }else{ }}
    <a class="" lay-event="approval">合伙人</a>
    {{# } }}
</script>

<script type="text/html" id="type">
    {{# if(d.type==1){ }}
    <a class="layui-btn layui-btn-xs layui-btn" lay-event="">挂买</a>
    {{# }else{  }}
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="">挂卖</a>
    {{# } }}
</script>

<!--<script type="text/html" id="price">-->

<!--<a class="" lay-event="">{{d.price}} {{d.name}}</a>-->

<!--</script>-->


{include file="common/foot"/}
<script>
    layui.use(['table', 'form'], function () {
        var table = layui.table, form = layui.form, $ = layui.jquery;
        var tableIn = table.render({
            elem: '#list',
            url: '{:url("tradeList")}',
            method: 'post',
            page: true,
            cols: [[
                {type: "checkbox", fixed: true},
                {field: 'trade_id', title: '{:lang("id")}', align: 'center', fixed: true, sort: true},
                //{field: 'user_id', title: '会员id', align: 'center', fixed: true},
                //{field: 'username', title: '会员名', align: 'center', fixed: true, sort: true},
                {field: 'mobile', title: '手机号', align: 'center', fixed: true},
                {field: 'id_name', title: '真实姓名', align: 'center', fixed: true},
                {field: 'user_level', align: 'center', title: '用户级别', toolbar: '#user_level', fixed: true},
                {field: 'fact_level', title: '实际匹配等级', align: 'center', fixed: true},
                {field: 'admin_level', title: '后台设置等级', align: 'center', fixed: true},
                {field: 'final_level', title: '最终匹配等级', align: 'center', fixed: true},
                //{field: 'amount1', title: '下级提供撮合', align: 'center', fixed: true},
                //{field: 'amount2', title: '平台提供撮合', align: 'center', fixed: true},
                {field: 'amount', title: '总撮合量', align: 'center', fixed: true},
                {field: 'deal_num', title: '预计成交', align: 'center', fixed: true},
                {field: 'type', title: '交易类型', align: 'center', fixed: true, toolbar: '#type'},
                {field: 'coin_name', title: '通证名称', align: 'center', fixed: true},
                {field: 'price', title: '价格(USDT)', align: 'center', fixed: true},
                {field: 'num', title: '数量', align: 'center', fixed: true},
                {field: 'total', title: '总价(USDT)', align: 'center', fixed: true},
                //{field: 'deal_num', title: '成交数量', align: 'center', fixed: true},
                {field: 'fee', title: '手续费(USDT)', align: 'center', fixed: true},
                //{field: 'deal_fee', title: '已成交手续费', align: 'center', fixed: true},
                {field: 'status', title: '{:lang("status")}', toolbar: '#status', align: 'center', fixed: true},
                {field: 'addtime', title: '添加时间', align: 'center', fixed: true},
//                {field: 'date', title: '添加日期', align: 'center', fixed: true},
//                {field: 'remark', title: '备注', align: 'center',fixed: true},
            ]],
            limit: 10, //每页默认显示的数量
        });
        //状态绑定事件
        /*form.on('switch(open)', function(obj){
           loading =layer.load(1, {shade: [0.1,'#fff']});
           var paytype_id = this.value;
           var status = obj.elem.checked===true?1:0;
            $.post('{:url("userPay_status")}',{'paytype_id':paytype_id,'status':status},function (res) {
               layer.close(loading);
                if (res.status==1) {
                    tableIn.reload();
                }else{
                   layer.msg(res.msg,{time:1000,icon:2});
                    return false;
               }
            })
        });*/
        //是否删除绑定事件
        /*form.on('switch(action)', function(obj){
            loading =layer.load(1, {shade: [0.1,'#fff']});
            var payment_id = this.value;
            var del = obj.elem.checked===true?1:0;
            $.post('{:url("users/userPay_del")}',{'payment_id':payment_id,'deleted':del},function (res) {
                layer.close(loading);
                if (res.status==1) {
                    tableIn.reload();
                }else{
                    layer.msg(res.msg,{time:1000,icon:2});
                    return false;
                }
            })
        });*/

        //搜索
        $('#search').on('click', function () {
            var key = $('#key').val();
            var date = $('#test').val();
            var status = $('#select_status').val();
            var coin_id = $('#select_status2').val();
            var type = $('#select_type').val();
            var final_level = $('#select_status3').val();
            // if ($.trim(key) === '') {
            //     layer.msg('{:lang("pleaseEnter")}关键字！', {icon: 0});
            //     return;
            // }
            tableIn.reload({
                where: {key: key, date: date, status: status, coin_id: coin_id, type: type, final_level: final_level}
            });
        });

        layui.use('laydate', function () {
            var laydate = layui.laydate;
            laydate.render({
                elem: '#test'
                , type: 'datetime'
                , range: true
                , theme: 'molv'
            });
        });


        //给删除绑定时间
        /*
                table.on('tool(list)', function(obj){
                    var data = obj.data;
                    if(obj.event === 'delete'){
                        layer.confirm('{:lang("Are you sure you want to delete it")}', function(index){
                            $.post("{:url('userPay_del')}",{paytype_id:data.paytype_id},function(res){
                                if(res.code==1){
                                    layer.msg(res.msg,{time:1000,icon:1});
                                    obj.del();
                                }else{
                                    layer.msg(res.msg,{time:1000,icon:2});
                                }
                            });
                            layer.close(index);
                        });
                    }
                });
        */


    });
</script>
</body>
</html>